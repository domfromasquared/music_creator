<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>RetroLoop Studio</title>
<link rel="stylesheet" href="src/css/styles.css"/>
</head>
<body>
<h1>RetroLoop Studio</h1>
<p class="sub">
4/4 • Drum sequencer + piano roll • Loop size:
<span class="kbd" id="resText">1/64</span> • Keys: C3 → C5
</p>

<div class="wrap workspace">
<div class="card" id="transportCard" style="grid-column: 1 / -1;">
  <div class="transport-bar">
    <div class="transport-group controls" aria-label="Transport controls">
      <button id="stopBtn" class="icon-btn stop" disabled title="Stop">
        <span class="icon">■</span>
      </button>
      <button id="playBtn" class="icon-btn play" title="Play">
        <span class="icon">▶</span>
      </button>
      <button id="pauseBtn" class="icon-btn pause" disabled title="Pause">
        <span class="icon">❚❚</span>
      </button>
    </div>

    <div class="transport-group time" aria-label="Time display">
      <div id="timeDisplay" class="time-main">000.1</div>
      <div class="time-sub"><span>BAR</span><span>BEAT</span></div>
    </div>

    <div class="transport-group tempo" aria-label="Tempo">
      <div class="tempo-main"><span id="bpmLabel" class="tempo-value">115</span><span class="tempo-unit">BPM</span></div>
      <input id="bpm" class="tempo-slider" type="range" min="70" max="180" value="115"/>
    </div>

    <div class="transport-group meta" aria-label="Signature and key">
      <div class="meta-row">
        <span class="pill small">4/4</span>
        <span class="pill small">Cmaj</span>
      </div>
      <div class="meta-hint">Space: Play/Pause</div>
    </div>

    <div class="transport-group meter" aria-label="Master meter">
      <div class="meter-bar"><span id="meterFill"></span></div>
    </div>
  </div>
</div>

<div id="transportSpacer" aria-hidden="true"></div>

<div class="card module" id="mixerModule" style="grid-column: 1 / -1;">
<div class="hd">
<div class="title">Mixer</div>
<div class="pill" style="padding:6px 10px;">
<span>Reverb</span><span class="kbd">Return</span>
</div>
</div>
<div class="bd">
<div class="mixer" style="margin-top:0;">
<div class="mixerTop" style="display:none;">
<div class="mixerTitle">Mixer</div>
<div class="pill" style="padding:6px 10px;">
<span>Reverb</span><span class="kbd">Return</span>
</div>
</div>

<div class="mixerGrid" id="mixerGrid"></div>
</div>

</div>
</div>

<div class="card module" id="drumModule">
<div class="hd">
<div class="left">
<button class="miniBtn" id="addDrumRowBtn" title="Add drum row" style="border-radius:999px; padding:6px 12px;">+</button>
<div class="title">Drum Sequencer</div>
</div>
<div class="pill"><span>Loop</span><select class="kbd" id="loopSelectDrum"></select></div>
</div>
<div class="bd">
<div class="drumGrid" id="drumGrid"></div>
</div>
</div>

<div class="card module" id="rollModule" style="grid-column: 1 / -1;">
<div class="hd">
<div class="title">Piano Roll</div>
<div class="rollHeaderRight">
<div class="tabs" id="tabs"></div>
<div class="trKnobs" id="trKnobs" aria-label="Transpose knobs"></div>
<div class="pill" style="padding:6px 10px;"><span>Loop</span><select class="kbd" id="loopSelectRoll"></select></div></div>
</div>

<div class="bd">
<div class="rollWrap">
<canvas id="roll" width="1280" height="560"></canvas>
</div>
</div>
</div>
</div>

<input id="colorPicker" type="color" style="display:none;" />

<!-- MIDI LIBRARY MODAL -->
<div class="modalOverlay" id="midiModalOverlay" aria-hidden="true">
<div class="modal" role="dialog" aria-modal="true" aria-label="MIDI Library">
<div class="modalHd">
<div class="modalTitle">
<span>MIDI Library</span>
<span class="kbd" id="targetLaneBadge">Target: Piano</span>
</div>
<div class="modalControls">
<div class="pill" id="laneSuggestPill" style="display:none; padding:6px 10px;">
<span>Suggested</span>
<span class="kbd" id="laneSuggestText">—</span>
<button class="miniBtn primary" id="applyLaneSuggestion" style="padding:6px 10px; border-radius:999px;">Switch</button>
</div>
<button class="miniBtn" id="refreshMidiIndex">Refresh</button>
<button class="miniBtn" id="closeMidiModal">Close</button>
</div>
</div>
<div class="modalBd">
<div class="libLeft">
<div class="searchRow">
<input class="input" id="midiSearch" placeholder="Search packs / files..." />
<label class="toggle">
<input type="checkbox" id="fitToLoop" checked />
Fit to loop
</label>
</div>
<div id="packList"></div>
<div class="status" id="midiIndexStatus"></div>
</div>
<div class="libRight">
<div id="fileList"></div>
<div class="status" id="midiFileStatus"></div>
</div>
</div>
</div>
</div>





<script src="https://cdn.jsdelivr.net/npm/@tonejs/midi@2.0.28/build/Midi.js"></script>
<script src="src/js/app.js"></script>
</body>
</html>
